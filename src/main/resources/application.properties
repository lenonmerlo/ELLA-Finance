spring.application.name=backend
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/ella}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD}

jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:900000}
jwt.refreshExpiration=604800000

cors.allowedOrigins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173,http://localhost:5174}

# Frontend URLs (used in emails)
# Override in prod via APP_FRONTEND_BASE_URL / APP_FRONTEND_RESET_PASSWORD_PATH
app.frontend.base-url=${APP_FRONTEND_BASE_URL:http://localhost:5173}
app.frontend.reset-password-path=${APP_FRONTEND_RESET_PASSWORD_PATH:/auth/reset-password}

# ============================================
# Score ELLA (0-100)
# ============================================
# Quantidade total de categorias consideradas no cálculo de diversidade.
ella.score.diversity.total-categories=${ELLA_SCORE_DIVERSITY_TOTAL_CATEGORIES:10}
# Janela (dias) para observar categorias diferentes.
ella.score.diversity.lookback-days=${ELLA_SCORE_DIVERSITY_LOOKBACK_DAYS:90}
# Janela (meses) para consistência (desvio padrão/ média).
ella.score.consistency.months=${ELLA_SCORE_CONSISTENCY_MONTHS:3}

# OCR (scanned PDFs)
# Enable OCR fallback for scanned/image-only invoices.
ella.ocr.enabled=${ELLA_OCR_ENABLED:true}
# Tesseract language(s). Examples: por, eng, por+eng
ella.ocr.language=${ELLA_OCR_LANGUAGE:por}
# Optional tessdata folder (where "tessdata" lives). If blank, relies on local installation/env (e.g., TESSDATA_PREFIX).
ella.ocr.tessdata-path=${ELLA_OCR_TESSDATA_PATH:}

# PDF -> image rendering settings for OCR
# If extracted PDF text length is below this threshold, OCR will be attempted.
ella.ocr.pdf.min-text-length=${ELLA_OCR_PDF_MIN_TEXT_LENGTH:200}
# Rendering DPI (higher = better accuracy, slower). Typical: 200-300.
ella.ocr.pdf.render-dpi=${ELLA_OCR_PDF_RENDER_DPI:220}
# Safety cap to avoid very large invoices locking the server.
ella.ocr.pdf.max-pages=${ELLA_OCR_PDF_MAX_PAGES:6}

# Invoice PDF text debug (DEV ONLY)
# When enabled, logs the raw extracted text that is fed into the invoice parsers.
# WARNING: this may contain sensitive transaction data.
ella.invoice.debug.log-extracted-text=${ELLA_INVOICE_DEBUG_LOG_EXTRACTED_TEXT:false}
# Max chars to print when logging extracted text. Use 0 or negative to print full text.
ella.invoice.debug.extracted-text-max-chars=${ELLA_INVOICE_DEBUG_EXTRACTED_TEXT_MAX_CHARS:2000}

# DEV ONLY: logs a small snippet around due-date keywords instead of dumping full text.
ella.invoice.debug.due-date-snippets=${ELLA_INVOICE_DEBUG_DUE_DATE_SNIPPETS:false}
ella.invoice.debug.due-date-context-chars=${ELLA_INVOICE_DEBUG_DUE_DATE_CONTEXT_CHARS:140}

# Dashboard debug (DEV ONLY)
# Quando habilitado, lista quais transações EXPENSE entram no summary.totalExpenses.
ella.dashboard.debug.summary-expenses=${ELLA_DASHBOARD_DEBUG_SUMMARY_EXPENSES:false}
ella.dashboard.debug.summary-expenses-max-items=${ELLA_DASHBOARD_DEBUG_SUMMARY_EXPENSES_MAX_ITEMS:60}

# Critical transactions (backend detection)
ella.critical.enabled=true
ella.critical.amount-threshold=5000

# DEV ONLY: habilita /api/auth/dev/reset-password (somente para ambiente local)
# Você pode sobrescrever por variável de ambiente APP_DEV_RESET_PASSWORD_TOKEN.
app.dev.reset-password-token=${APP_DEV_RESET_PASSWORD_TOKEN:}

# ============================================
# Extraction Quality Score Configuration
# ============================================
extraction.quality.min-score-for-acceptance=90
extraction.quality.min-score-for-high-quality=75
extraction.quality.min-transactions=3
extraction.quality.min-text-length=800
extraction.quality.max-garbled-percent=5

# ============================================
# Adobe PDF Extract API Configuration
# ============================================

# OAuth Server-to-Server Credentials
# Obtém em: https://console.adobe.io/
adobe.oauth.client-id=${ADOBE_CLIENT_ID:}
adobe.oauth.access-token=${ADOBE_ACCESS_TOKEN:}

# API Endpoint (padrão)
adobe.oauth.api-endpoint=https://pdf-services.adobe.io

# Timeout em segundos
adobe.oauth.timeout=60

# Habilitar/desabilitar Adobe Extractor
# Default: true (mas só funciona se credenciais estiverem configuradas)
adobe.oauth.enabled=true

# ============================================
# Email Configuration
# ============================================
email.enabled=${EMAIL_ENABLED:true}
email.from=${EMAIL_FROM:}
email.resend.api-key=${RESEND_API_KEY:}
email.require-config-on-startup=${EMAIL_REQUIRE_CONFIG_ON_STARTUP:false}
